# 新闻知识图谱

# 本部分负责人：郑芮芳 联系方式：3420015229@qq.com

## 框架仓库地址：https://gitee.com/zzz_49_0/incremental-package

## 已保存到neo4j,示例：![描述文字](https://i.imgur.com/oZSHTXn.png)

## 数据：toutiao_recommendations.csv
## 代码：2025_1_7/kuangjia.py（共53条规则）
## 结果：1月7日输出文件夹

##  一、整体框架设计

### 1.知识抽取器类定义（KnowledgeExtractor）

#### 初始化：创建 KnowledgeExtractor 类，在其 __init__ 方法中初始化一个空的规则列表 self.rules，用于后续存储各种知识抽取规则。规则添加方法：add_rule 方法用于向规则列表中添加规则，每个规则以字典形式包含 name（规则名称，便于识别和区分不同抽取内容）、pattern（经过特定设置的正则表达式对象，用于匹配文本中相应知识的模式，设置了诸如匹配任意字符、忽略大小写等属性以提高匹配灵活性和准确性）以及 extract_func（用于从匹配结果中提取具体知识内容的函数）。知识抽取执行方法：extract 方法接收要处理的文本，先利用 jieba.posseg 对文本进行分词和词性标注，然后遍历已添加的规则列表，使用规则中的正则表达式在文本中查找匹配项，若有匹配再通过对应的提取函数从匹配结果及分词词性标注结果中提取出所需知识，最后将各规则抽取到的知识以字典形式返回。

### 2.知识图谱构建函数（build_knowledge_graph）

#### 以抽取到的单篇文章知识（以字典形式表示）和文章编号为输入，基于 networkx 库构建知识图谱。首先创建代表文章的节点，接着针对抽取知识字典中的每个键值对（若值为列表则遍历列表元素），为每个知识元素创建对应节点，并与文章节点建立边关系，边的类型通过键（即规则名称）来表示，以此构建起文章相关的知识图谱结构。

### 3. 数据存储到 Neo4j 函数（save_to_neo4j）

#### 负责将构建好的知识图谱（以 networkx 图结构表示）保存到 Neo4j 数据库中。先连接到 Neo4j 数据库，然后遍历知识图谱的节点，检查节点在数据库中是否已存在（通过节点类型和名称进行匹配），不存在则创建新节点，接着遍历知识图谱的边，同样查找起始和结束节点在数据库中的对应节点，若都存在则创建或合并对应的关系，最终提交事务完成数据存储，同时记录存储成功的日志信息。

### 4.主流程控制部分

#### 首先从指定路径读取 CSV 文件（新闻数据文件，包含标题和正文等列），接着创建一个总的空的 networkx 知识图谱 G_total，用于合并每篇文章的知识图谱。然后遍历 CSV 文件中的每一行数据（代表每篇文章），将文章标题和正文合并为完整文本，若文本不为空则利用 KnowledgeExtractor 实例抽取知识，构建单篇文章的知识图谱 G_article，并将其合并到总图谱 G_total 中，同时打印出该篇文章的知识抽取结果。之后设置输出文件夹路径，将最终的总知识图谱保存为 GEXF 格式文件到输出文件夹中，并调用 save_to_neo4j 函数将总图谱数据存储到 Neo4j 数据库。最后统计总图谱中关系和实体的相关信息（如最常见的关系、实体及其出现次数等），并将这些统计信息保存到文本文件中记录下来。

## 二、规则设计

### 1.规则的表示与添加方式

#### 通过 KnowledgeExtractor 类的 add_rule 方法来添加规则，每条规则都明确指定了规则名称、用于匹配的正则表达式模式以及对应的提取函数。例如，针对不同类型的知识如 “事件主体”“人物”“地点”“时间” 等分别定义规则，正则表达式根据对应知识通常在文本中的表述特点来编写，像匹配 “事件主体” 的正则表达式会寻找由 2 - 10 个中文字符组成且后面跟着特定表示组织、机构等词语的字符串，以此来定位可能的事件主体相关文本内容。

### 2.规则涵盖的知识类型及示例

#### 事件主体规则：旨在抽取新闻文本中涉及的各类主体，如部队、组织、机构、公司等相关名称。其正则表达式按照名称的字数范围以及常见主体相关后缀词来定义，提取函数通过结合分词词性标注结果，筛选出实际在文本中作为名词出现的匹配内容，确保抽取的是有效的主体名称。人物规则：聚焦于抽取不同身份的人物名称，正则表达式根据人物称呼常见的姓氏加特定身份后缀（如先生、女士、各类职务等）来编写，提取函数利用词性标注中 “nr”（人名）这一标注来准确提取出真正表示人物的匹配内容。地点规则：用于提取新闻中提到的各类地点，正则表达式根据地点名称常见的字数范围以及常见地点类别后缀（国、省、市等）来构建，提取函数借助词性标注里 “ns”（地名）的标注来筛选出符合要求的地点名称。时间规则：针对文本中出现的时间表述进行抽取，正则表达式涵盖了具体年月日格式以及一些相对模糊的时间词（昨天、今天等），提取函数依靠词性标注中 “t”（时间词）的标注来准确提取出文本里的时间相关内容。等等。

## 总结

### 总的来说，代码构建了一个围绕 KnowledgeExtractor 类为核心的框架，先定义好规则，再通过对新闻文本进行分词和词性标注后，利用规则中的正则表达式匹配及提取函数处理来挖掘知识，之后基于这些知识构建和整合知识图谱，并存储到 Neo4j 数据库以及进行相关统计分析，规则设计上充分考虑不同类型知识的文本特征，以实现较为准确全面的知识抽取。